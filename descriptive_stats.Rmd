---
title: "descriptive_stats"
author: "Kriti Singh"
date: '2022-03-30'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r}

setwd("H:/Menu Labeling in California/CAmenulabeling")
getwd()

library(tidyverse)
library(ggplot2)

#install.packages("sqldf")
library(sqldf)


df <- read.csv("ca_ds_223003.csv", stringsAsFactors = FALSE)
df <- df[,-1] #this removes the column with index numbers

```

```{r}

#check that the number of restaurants 
sqldf('select count(distinct restaurant_id) from df') 

#across all months
#Occasion = 2 -> # of restaurants: 947
#Occasion = 1, 3 -> # of restaurants: 1055

#filtered by baseline period (3-8 months before implementation) - table produced by code below looks correct
df %>%
  filter(DW_MONTH %in% (245:250)) %>%
  group_by(DW_OCCASION) %>%
  summarise(no_rest = n_distinct(restaurant_id))

#number of months for each restaurant
df %>%
  group_by(restaurant_id) %>%
  summarise(month_count = n_distinct(DW_MONTH)) %>%
  summary(month_count) #number of restaurants for each restaurant should between 1 and 106 (which it is based on this check)

#histogram: number of months for across restaurants
df %>%
  group_by(restaurant_id) %>%
  summarise(month_count = n_distinct(DW_MONTH)) %>%
  ggplot(aes(x=month_count)) + 
  geom_histogram(binwidth = 2) +
  scale_x_continuous(breaks = seq(0, 120, by = 10))

#histogram: occasion distribution
df %>%
  group_by(restaurant_id) %>%
  ggplot(aes(x=DW_OCCASION)) + 
  geom_histogram(binwidth = 0.5) +
  scale_x_continuous(breaks = seq(0, 4, by = 1))

#histogram mean calories by occasion
plot3 <- df %>%
  select(restaurant_id, cal, DW_OCCASION) %>%
  group_by(restaurant_id, DW_OCCASION) %>%
  mutate(mean_cal = mean(cal)) 




  ggplot(plot3, aes(x=mean_cal, color=DW_OCCASION)) +
  geom_histogram(binwidth = 100000) +
  scale_x_continuous(breaks = seq(400000, 15000000, by = 500000))
  
  summary(plot3$mean_cal)

```

